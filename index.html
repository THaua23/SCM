<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCM Natura - Gestão da Cadeia de Suprimentos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f4f0; /* Tom de terra claro */
        }
        .natura-laranja {
            color: #ff7a00;
        }
        .natura-verde {
            color: #005a3c;
        }
        .bg-natura-laranja {
            background-color: #ff7a00;
        }
        .bg-natura-verde {
            background-color: #005a3c;
        }
        .borda-natura-laranja {
            border-color: #ff7a00;
        }
        .item-linha-tempo::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 40px;
            bottom: -20px;
            width: 2px;
            background-color: #e2e8f0;
            z-index: 1;
        }
        .item-linha-tempo:last-child::before {
            display: none;
        }
        .sidebar-link-ativo {
            background-color: #ffeadb;
            color: #ff7a00;
            font-weight: 600;
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .chart-bar {
            transition: height 0.5s ease-out;
        }
        .chart-bar:hover {
            opacity: 0.8;
            transform: translateY(-4px);
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="relative min-h-screen flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar bg-white w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-200 ease-in-out z-30 shadow-lg md:shadow-none">
            <div class="flex items-center space-x-2 px-4">
                <img src="https://placehold.co/120x40/005a3c/ffffff?text=Natura" alt="Logo Natura" class="h-10 rounded-lg">
            </div>
            <nav id="nav-sidebar">
                <a href="#" data-target="pagina-metricas" class="sidebar-link flex items-center space-x-3 text-gray-600 p-3 rounded-md hover:bg-gray-100 transition-colors duration-200 sidebar-link-ativo">
                    <i data-lucide="layout-dashboard"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" data-target="pagina-rastreamento" class="sidebar-link flex items-center space-x-3 text-gray-600 p-3 rounded-md hover:bg-gray-100 transition-colors duration-200">
                    <i data-lucide="map-pin"></i>
                    <span>Rastreamento</span>
                </a>
                <a href="#" data-target="pagina-requisicao" class="sidebar-link flex items-center space-x-3 text-gray-600 p-3 rounded-md hover:bg-gray-100 transition-colors duration-200">
                    <i data-lucide="send"></i>
                    <span>Requisição</span>
                </a>
                <a href="#" data-target="pagina-pedidos-recentes" class="sidebar-link flex items-center space-x-3 text-gray-600 p-3 rounded-md hover:bg-gray-100 transition-colors duration-200">
                    <i data-lucide="history"></i>
                    <span>Pedidos Recentes</span>
                </a>
            </nav>
        </aside>

        <!-- Overlay para mobile -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black opacity-0 md:hidden z-20 transition-opacity duration-300 pointer-events-none"></div>


        <!-- Conteúdo Principal -->
        <div class="flex-1 flex flex-col h-screen overflow-y-hidden">
             <!-- Cabeçalho -->
            <header class="bg-white shadow-sm sticky top-0 z-10">
                <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                    <div class="flex items-center">
                        <button id="botao-menu" class="md:hidden mr-4 text-gray-600">
                            <i data-lucide="menu" class="h-6 w-6"></i>
                        </button>
                        <h1 class="hidden sm:block text-xl md:text-2xl font-bold text-gray-700">Gestão da Cadeia de Suprimentos</h1>
                    </div>
                    <div class="flex items-center space-x-2">
                        <i data-lucide="user-circle" class="h-6 w-6 text-gray-600"></i>
                        <span id="nomeExibido" class="hidden md:block font-medium">Olá, Gestor</span>
                    </div>
                </div>
            </header>

            <main class="flex-1 overflow-y-auto container mx-auto p-6">

                <!-- Página: Dashboard -->
                <div id="pagina-metricas" class="pagina-conteudo">
                    <section id="metricas">
                        <h2 class="text-xl font-semibold mb-4 natura-verde">Dashboard Operacional</h2>
                        <!-- Cards de Métricas -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                            <!-- Card 1 -->
                            <div class="bg-white p-6 rounded-lg shadow-md flex items-center space-x-4">
                                <div class="bg-green-100 p-3 rounded-full">
                                    <i data-lucide="package-check" class="h-8 w-8 text-green-600"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Pedidos Ativos</p>
                                    <p id="valorPedidosAtivos" class="text-2xl font-bold">1.480</p>
                                </div>
                            </div>
                            <!-- Card 2 -->
                            <div class="bg-white p-6 rounded-lg shadow-md flex items-center space-x-4">
                                <div class="bg-orange-100 p-3 rounded-full">
                                    <i data-lucide="warehouse" class="h-8 w-8 text-orange-500"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Nível de Estoque (CD)</p>
                                    <p id="valorNivelEstoque" class="text-2xl font-bold">85%</p>
                                </div>
                            </div>
                            <!-- Card 3 -->
                            <div class="bg-white p-6 rounded-lg shadow-md flex items-center space-x-4">
                                <div class="bg-blue-100 p-3 rounded-full">
                                   <i data-lucide="truck" class="h-8 w-8 text-blue-600"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Eficiência da Entrega</p>
                                    <p class="text-2xl font-bold">97.2%</p>
                                </div>
                            </div>
                            <!-- Card 4 -->
                            <div class="bg-white p-6 rounded-lg shadow-md flex items-center space-x-4">
                                 <div class="bg-emerald-100 p-3 rounded-full">
                                   <i data-lucide="leaf" class="h-8 w-8 text-emerald-700"></i>
                                </div>
                                <div>
                                    <p class="text-gray-500 text-sm">Índice de Sustentabilidade</p>
                                    <p class="text-2xl font-bold">92.5</p>
                                </div>
                            </div>
                        </div>

                        <!-- Novos Componentes do Dashboard -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-8">
                            <!-- Gráfico de Pedidos -->
                            <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                                <h3 class="font-semibold mb-4 text-gray-700">Pedidos nos Últimos 7 Dias</h3>
                                <div id="chart-container" class="flex justify-between h-64 border-l border-b border-gray-200 p-4">
                                    <!-- As barras do gráfico serão inseridas aqui dinamicamente -->
                                </div>
                            </div>
                            <!-- Alerta de Baixo Estoque -->
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="font-semibold mb-4 text-gray-700">Alerta de Baixo Estoque</h3>
                                <div id="listaAlertaEstoque" class="space-y-4">
                                    <!-- Os alertas de estoque serão inseridos aqui dinamicamente -->
                                </div>
                            </div>
                        </div>

                        <!-- Status dos Centros de Distribuição -->
                        <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                             <h3 class="font-semibold mb-4 text-gray-700">Status dos Centros de Distribuição</h3>
                             <div class="overflow-x-auto">
                                <table class="w-full text-left text-sm">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="p-2 font-semibold">CD</th>
                                            <th class="p-2 font-semibold">Status</th>
                                            <th class="p-2 font-semibold">Capacidade Utilizada</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="border-b hover:bg-gray-50">
                                            <td class="p-2">São Paulo, SP</td>
                                            <td class="p-2 flex items-center"><span class="h-2.5 w-2.5 bg-green-500 rounded-full mr-2"></span> Operacional</td>
                                            <td class="p-2">
                                                <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-natura-verde h-2.5 rounded-full" style="width: 88%"></div></div>
                                            </td>
                                        </tr>
                                         <tr class="border-b hover:bg-gray-50">
                                            <td class="p-2">Benevides, PA</td>
                                            <td class="p-2 flex items-center"><span class="h-2.5 w-2.5 bg-green-500 rounded-full mr-2"></span> Operacional</td>
                                            <td class="p-2">
                                                <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-natura-verde h-2.5 rounded-full" style="width: 75%"></div></div>
                                            </td>
                                        </tr>
                                         <tr class="border-b hover:bg-gray-50">
                                            <td class="p-2">Jaboatão, PE</td>
                                            <td class="p-2 flex items-center"><span class="h-2.5 w-2.5 bg-yellow-400 rounded-full mr-2"></span> Atenção</td>
                                            <td class="p-2">
                                                <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-natura-laranja h-2.5 rounded-full" style="width: 95%"></div></div>
                                            </td>
                                        </tr>
                                        <tr class="hover:bg-gray-50">
                                            <td class="p-2">Uberlândia, MG</td>
                                            <td class="p-2 flex items-center"><span class="h-2.5 w-2.5 bg-green-500 rounded-full mr-2"></span> Operacional</td>
                                            <td class="p-2">
                                                <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-natura-verde h-2.5 rounded-full" style="width: 60%"></div></div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                             </div>
                        </div>
                    </section>
                </div>
                
                <!-- Página: Rastreamento -->
                <div id="pagina-rastreamento" class="pagina-conteudo hidden">
                    <section id="rastreamento" class="mb-8">
                        <div class="bg-white p-8 rounded-lg shadow-md">
                            <h2 class="text-xl font-semibold mb-4 natura-verde">Rastreamento de Produto</h2>
                            <div class="flex flex-col sm:flex-row gap-4 mb-6">
                                <input type="text" id="inputCodigoRastreamento" placeholder="Insira o código do lote ou pedido (ex: NT2025BR001)" class="flex-grow p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-natura-laranja">
                                <button id="botaoRastrear" class="bg-natura-laranja text-white font-bold py-3 px-6 rounded-md hover:opacity-90 transition-opacity flex items-center justify-center space-x-2">
                                    <i data-lucide="search" class="h-5 w-5"></i>
                                    <span>Rastrear Produto</span>
                                </button>
                            </div>
                            <div id="resultadoRastreamento" class="mt-6">
                               <div class="text-center text-gray-500 py-8">
                                   <i data-lucide="info" class="mx-auto h-12 w-12 text-gray-400 mb-2"></i>
                                   <p>Aguardando a inserção de um código para rastreamento.</p>
                               </div>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Página: Requisição -->
                <div id="pagina-requisicao" class="pagina-conteudo hidden">
                    <section id="requisicao" class="mb-8">
                        <div class="bg-white p-8 rounded-lg shadow-md">
                            <h2 class="text-xl font-semibold mb-4 natura-verde">Requisição de Novos Pedidos</h2>
                            <form id="formRequisicao" class="space-y-4">
                                <div>
                                     <label for="selectProduto" class="block text-sm font-medium text-gray-700 mb-1">Produto</label>
                                     <select id="selectProduto" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-natura-laranja"></select>
                                </div>
                                <div>
                                     <label for="inputQuantidade" class="block text-sm font-medium text-gray-700 mb-1">Quantidade</label>
                                     <input type="number" id="inputQuantidade" min="1" placeholder="Ex: 50" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-natura-laranja">
                                </div>
                                <button type="submit" id="botaoRequisitar" class="w-full bg-natura-verde text-white font-bold py-3 px-6 rounded-md hover:opacity-90 transition-opacity flex items-center justify-center space-x-2">
                                    <i data-lucide="send" class="h-5 w-5"></i>
                                    <span>Solicitar Pedido</span>
                                </button>
                            </form>
                            <div id="feedbackRequisicao" class="mt-4 text-center h-6"></div>
                        </div>
                    </section>
                </div>

                <!-- Página: Pedidos Recentes -->
                <div id="pagina-pedidos-recentes" class="pagina-conteudo hidden">
                    <section id="pedidosRecentes">
                        <div class="bg-white p-8 rounded-lg shadow-md">
                            <h2 class="text-xl font-semibold mb-4 natura-verde">Últimos Pedidos Solicitados</h2>
                            <div id="listaPedidosRecentes" class="overflow-x-auto">
                                <p class="text-center text-gray-500 py-4">Nenhum pedido foi solicitado ainda.</p>
                            </div>
                        </div>
                    </section>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal de Login -->
    <div id="modalLogin" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 transition-opacity duration-300">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm transform transition-all duration-300 scale-95">
            <img src="https://placehold.co/150x50/005a3c/ffffff?text=Natura" alt="Logo Natura no Modal" class="mx-auto h-12 mb-4 rounded-lg">
            <h2 class="text-xl font-bold mb-2 text-center natura-verde">Controle de Acesso SCM</h2>
            <p class="text-center text-gray-500 text-sm mb-6">Por favor, insira as suas credenciais.</p>
            <div class="space-y-4">
                <div>
                    <label for="inputNome" class="block text-sm font-medium text-gray-700 mb-1">Nome de Utilizador</label>
                    <input type="text" id="inputNome" placeholder="Digite seu nome de utilizador" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-natura-laranja">
                </div>
                 <div>
                    <label for="inputSenha" class="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                    <input type="password" id="inputSenha" placeholder="Digite sua senha" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-natura-laranja">
                </div>
                <div id="mensagemErroLogin" class="text-red-600 text-sm text-center h-5"></div>
                <button id="botaoEntrar" class="w-full bg-natura-laranja text-white font-bold py-3 px-6 rounded-md hover:opacity-90 transition-opacity">
                    Entrar
                </button>
            </div>
        </div>
    </div>


    <script>
        lucide.createIcons();

        document.addEventListener('DOMContentLoaded', () => {

            // --- LÓGICA DA SIDEBAR E NAVEGAÇÃO POR ABAS ---
            const sidebar = document.getElementById('sidebar');
            const botaoMenu = document.getElementById('botao-menu');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const navLinks = document.querySelectorAll('.sidebar-link');
            const paginas = document.querySelectorAll('.pagina-conteudo');

            function toggleSidebar() {
                sidebar.classList.toggle('-translate-x-full');
                sidebarOverlay.classList.toggle('opacity-50');
                sidebarOverlay.classList.toggle('pointer-events-auto');
                sidebarOverlay.classList.toggle('opacity-0');
                sidebarOverlay.classList.toggle('pointer-events-none');
            }

            botaoMenu.addEventListener('click', toggleSidebar);
            sidebarOverlay.addEventListener('click', toggleSidebar);

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();

                    const targetId = link.dataset.target;
                    
                    // Esconde todas as páginas
                    paginas.forEach(pagina => {
                        pagina.classList.add('hidden');
                    });
                    
                    // Mostra a página alvo
                    document.getElementById(targetId).classList.remove('hidden');

                    // Atualiza o link ativo
                    navLinks.forEach(navLink => {
                        navLink.classList.remove('sidebar-link-ativo');
                    });
                    link.classList.add('sidebar-link-ativo');

                    // Fecha a sidebar em mobile após o clique
                    if (window.innerWidth < 768) {
                        toggleSidebar();
                    }
                });
            });


            // --- LÓGICA DO MODAL ---
            const modalLogin = document.getElementById('modalLogin');
            const modalContent = modalLogin.querySelector('div');
            const botaoEntrar = document.getElementById('botaoEntrar');
            const inputNome = document.getElementById('inputNome');
            const inputSenha = document.getElementById('inputSenha');
            const nomeExibido = document.getElementById('nomeExibido');
            const mensagemErroLogin = document.getElementById('mensagemErroLogin');

             setTimeout(() => {
                modalLogin.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
             }, 100);

            botaoEntrar.addEventListener('click', () => {
                const nome = inputNome.value.trim();
                const senha = inputSenha.value.trim();

                if (nome && senha) {
                    mensagemErroLogin.textContent = '';
                    nomeExibido.textContent = `Olá, ${nome}`;
                    
                    modalLogin.classList.add('opacity-0');
                    modalContent.classList.add('scale-95');
                    setTimeout(() => {
                        modalLogin.classList.add('hidden');
                    }, 300);

                    inputNome.value = ''; 
                    inputSenha.value = '';
                } else {
                    mensagemErroLogin.textContent = 'Por favor, preencha todos os campos.';
                }
            });
            
            // --- LÓGICA DO GRÁFICO DE BARRAS ---
            function renderizarGraficoPedidos() {
                const chartContainer = document.getElementById('chart-container');
                if (!chartContainer) return; // Checagem de segurança

                const chartData = [
                    { day: 'Seg', value: 180, percentage: 60, color: 'bg-sky-400' },
                    { day: 'Ter', value: 225, percentage: 75, color: 'bg-teal-400' },
                    { day: 'Qua', value: 270, percentage: 90, color: 'bg-emerald-500' },
                    { day: 'Qui', value: 210, percentage: 70, color: 'bg-lime-400' },
                    { day: 'Sex', value: 285, percentage: 95, color: 'bg-amber-500' },
                    { day: 'Sáb', value: 240, percentage: 80, color: 'bg-orange-400' },
                    { day: 'Dom', value: 150, percentage: 50, color: 'bg-red-400' }
                ];

                chartContainer.innerHTML = ''; // Limpa o container para evitar duplicatas

                chartData.forEach((item, index) => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'flex flex-col items-center justify-end space-y-2 h-full';

                    const bar = document.createElement('div');
                    bar.className = `chart-bar w-8 md:w-10 ${item.color} rounded-t-md relative`;
                    bar.title = `${item.value} pedidos`;
                    bar.style.height = '0%'; // Altura inicial para animação

                    const numberSpan = document.createElement('span');
                    numberSpan.className = 'absolute -top-5 left-1/2 -translate-x-1/2 text-xs font-bold text-gray-600';
                    numberSpan.textContent = item.value;
                    bar.appendChild(numberSpan);

                    const dayLabel = document.createElement('span');
                    dayLabel.className = 'text-xs text-gray-500';
                    dayLabel.textContent = item.day;

                    wrapper.appendChild(bar);
                    wrapper.appendChild(dayLabel);
                    chartContainer.appendChild(wrapper);

                    // Anima a altura da barra com um atraso escalonado
                    setTimeout(() => {
                        bar.style.height = `${item.percentage}%`;
                    }, 200 + (index * 100));
                });
            }
            renderizarGraficoPedidos();


            // --- LÓGICA DE RASTREAMENTO ---
            const botaoRastrear = document.getElementById('botaoRastrear');
            const inputCodigoRastreamento = document.getElementById('inputCodigoRastreamento');
            const resultadoRastreamento = document.getElementById('resultadoRastreamento');

            const dadosFicticiosRastreamento = {
                "NT2025BR001": {
                    productName: "Creme para Mãos Ekos Castanha",
                    stages: [
                        { icon: 'leaf', title: 'Coleta da Matéria-Prima', status: 'Concluído', details: 'Comunidade A, Amazônia', date: '10/08/2025', completed: true },
                        { icon: 'flask-conical', title: 'Processamento e Produção', status: 'Concluído', details: 'Fábrica de Benevides, PA', date: '15/08/2025', completed: true },
                        { icon: 'warehouse', title: 'Chegada ao Centro de Distribuição', status: 'Concluído', details: 'CD de São Paulo, SP', date: '20/08/2025', completed: true },
                        { icon: 'truck', title: 'Transporte para Consultora', status: 'Em Andamento', details: 'Em rota para Rio de Janeiro, RJ', date: '22/08/2025', completed: false },
                        { icon: 'package-check', title: 'Entregue ao Cliente Final', status: 'Pendente', details: '', date: '', completed: false }
                    ]
                },
                "NT2025BR002": {
                    productName: "Perfume Kaiak Aventura",
                    stages: [
                        { icon: 'leaf', title: 'Coleta da Matéria-Prima', status: 'Concluído', details: 'Fornecedor de Ingredientes, SP', date: '01/09/2025', completed: true },
                        { icon: 'flask-conical', title: 'Processamento e Produção', status: 'Em Andamento', details: 'Fábrica de Cajamar, SP', date: '04/09/2025', completed: false },
                        { icon: 'warehouse', title: 'Chegada ao Centro de Distribuição', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'truck', title: 'Transporte para Consultora', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'package-check', title: 'Entregue ao Cliente Final', status: 'Pendente', details: '', date: '', completed: false }
                    ]
                },
                "NT2025BR003": {
                    productName: "Sabonete em Barra Ekos Maracujá",
                    stages: [
                        { icon: 'leaf', title: 'Coleta da Matéria-Prima', status: 'Concluído', details: 'Cooperativa Mista de Tomé-Açu, PA', date: '12/07/2025', completed: true },
                        { icon: 'flask-conical', title: 'Processamento e Produção', status: 'Concluído', details: 'Fábrica de Benevides, PA', date: '20/07/2025', completed: true },
                        { icon: 'warehouse', title: 'Chegada ao Centro de Distribuição', status: 'Concluído', details: 'CD de Jaboatão, PE', date: '28/07/2025', completed: true },
                        { icon: 'truck', title: 'Transporte para Consultora', status: 'Concluído', details: 'Entregue para Consultora em Salvador, BA', date: '02/08/2025', completed: true },
                        { icon: 'package-check', title: 'Entregue ao Cliente Final', status: 'Concluído', details: 'Cliente final, Salvador, BA', date: '05/08/2025', completed: true }
                    ]
                },
                "NT2025BR004": {
                    productName: "Óleo Trifásico Corporal Andiroba",
                    stages: [
                        { icon: 'leaf', title: 'Coleta da Matéria-Prima', status: 'Em Andamento', details: 'Comunidade do Rio Iratapuru, AP', date: '01/09/2025', completed: false },
                        { icon: 'flask-conical', title: 'Processamento e Produção', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'warehouse', title: 'Chegada ao Centro de Distribuição', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'truck', title: 'Transporte para Consultora', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'package-check', title: 'Entregue ao Cliente Final', status: 'Pendente', details: '', date: '', completed: false }
                    ]
                },
                "NT2025BR005": {
                    productName: "Deo Parfum Essencial Oud",
                    stages: [
                        { icon: 'leaf', title: 'Coleta da Matéria-Prima', status: 'Concluído', details: 'Fornecedor Internacional', date: '10/08/2025', completed: true },
                        { icon: 'flask-conical', title: 'Processamento e Produção', status: 'Concluído', details: 'Fábrica de Cajamar, SP', date: '25/08/2025', completed: true },
                        { icon: 'warehouse', title: 'Chegada ao Centro de Distribuição', status: 'Em Andamento', details: 'A caminho do CD de Itupeva, SP', date: '04/09/2025', completed: false },
                        { icon: 'truck', title: 'Transporte para Consultora', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'package-check', title: 'Entregue ao Cliente Final', status: 'Pendente', details: '', date: '', completed: false }
                    ]
                },
                "NT2025BR006": {
                    productName: "Sabonete Líquido Ekos Ucuuba",
                    stages: [
                        { icon: 'leaf', title: 'Coleta da Matéria-Prima', status: 'Pendente', details: 'Comunidade do Médio Juruá, AM', date: '', completed: false },
                        { icon: 'flask-conical', title: 'Processamento e Produção', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'warehouse', title: 'Chegada ao Centro de Distribuição', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'truck', title: 'Transporte para Consultora', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'package-check', title: 'Entregue ao Cliente Final', status: 'Pendente', details: '', date: '', completed: false }
                    ]
                },
                "NT2025BR007": {
                    productName: "Polpa Hidratante para Pés Ekos Açaí",
                    stages: [
                        { icon: 'leaf', title: 'Coleta da Matéria-Prima', status: 'Concluído', details: 'Cooperativa dos Produtores de Açaí, PA', date: '15/08/2025', completed: true },
                        { icon: 'flask-conical', title: 'Processamento e Produção', status: 'Concluído', details: 'Fábrica de Benevides, PA', date: '22/08/2025', completed: true },
                        { icon: 'warehouse', title: 'Chegada ao Centro de Distribuição', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'truck', title: 'Transporte para Consultora', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'package-check', title: 'Entregue ao Cliente Final', status: 'Pendente', details: '', date: '', completed: false }
                    ]
                },
                "NT2025BR008": {
                    productName: "Shampoo Lumina Cabelos Secos",
                    stages: [
                        { icon: 'leaf', title: 'Coleta da Matéria-Prima', status: 'Concluído', details: 'Fornecedor de Ativos, SP', date: '01/08/2025', completed: true },
                        { icon: 'flask-conical', title: 'Processamento e Produção', status: 'Em Andamento', details: 'Fábrica de Cajamar, SP', date: '08/08/2025', completed: false },
                        { icon: 'warehouse', title: 'Chegada ao Centro de Distribuição', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'truck', title: 'Transporte para Consultora', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'package-check', title: 'Entregue ao Cliente Final', status: 'Pendente', details: '', date: '', completed: false }
                    ]
                },
                 "NT2025BR009": {
                    productName: "Condicionador Murumuru",
                    stages: [
                        { icon: 'leaf', title: 'Coleta da Matéria-Prima', status: 'Concluído', details: 'Comunidade do Alto Juruá, AC', date: '19/08/2025', completed: true },
                        { icon: 'flask-conical', title: 'Processamento e Produção', status: 'Concluído', details: 'Fábrica de Benevides, PA', date: '28/08/2025', completed: true },
                        { icon: 'warehouse', title: 'Chegada ao Centro de Distribuição', status: 'Concluído', details: 'CD de Uberlândia, MG', date: '04/09/2025', completed: true },
                        { icon: 'truck', title: 'Transporte para Consultora', status: 'Em Andamento', details: 'Em rota para Brasília, DF', date: '05/09/2025', completed: false },
                        { icon: 'package-check', title: 'Entregue ao Cliente Final', status: 'Pendente', details: '', date: '', completed: false }
                    ]
                },
                "NT2025BR010": {
                    productName: "Batom Faces Matte Pink",
                    stages: [
                        { icon: 'leaf', title: 'Coleta da Matéria-Prima', status: 'Concluído', details: 'Fornecedor de Pigmentos, SP', date: '11/08/2025', completed: true },
                        { icon: 'flask-conical', title: 'Processamento e Produção', status: 'Concluído', details: 'Fábrica de Cajamar, SP', date: '20/08/2025', completed: true },
                        { icon: 'warehouse', title: 'Chegada ao Centro de Distribuição', status: 'Concluído', details: 'CD de São Paulo, SP', date: '25/08/2025', completed: true },
                        { icon: 'truck', title: 'Transporte para Consultora', status: 'Concluído', details: 'Entregue para Consultora em Campinas, SP', date: '28/08/2025', completed: true },
                        { icon: 'package-check', title: 'Entregue ao Cliente Final', status: 'Pendente', details: '', date: '', completed: false }
                    ]
                }
            };

            botaoRastrear.addEventListener('click', () => {
                const codigoRastreamento = inputCodigoRastreamento.value.trim().toUpperCase();
                
                if (!codigoRastreamento) {
                    exibirFeedback('Por favor, insira um código de rastreamento.', 'error');
                    return;
                }

                exibirCarregando();

                setTimeout(() => {
                    const dados = dadosFicticiosRastreamento[codigoRastreamento];
                    if (dados) {
                        exibirInfosRastreamento(codigoRastreamento, dados);
                    } else {
                        exibirFeedback(`Nenhum resultado encontrado para o código "${codigoRastreamento}".`, 'error');
                    }
                }, 1500);
            });

            function exibirCarregando() {
                resultadoRastreamento.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-natura-laranja mx-auto mb-4"></div>
                        <p>Buscando informações...</p>
                    </div>
                `;
            }

            function exibirFeedback(mensagem, tipo = 'info') {
                const icone = tipo === 'error' ? 'circle-alert' : 'info';
                const cor = tipo === 'error' ? 'text-red-500' : 'text-gray-500';

                resultadoRastreamento.innerHTML = `
                    <div class="text-center ${cor} py-8">
                        <i data-lucide="${icone}" class="mx-auto h-12 w-12 mb-2"></i>
                        <p>${mensagem}</p>
                    </div>
                `;
                lucide.createIcons();
            }

            function exibirInfosRastreamento(id, dados) {
                let htmlLinhaDoTempo = `
                    <div class="border-l-2 borda-natura-laranja pl-6 mb-6">
                        <h3 class="text-lg font-bold">${dados.productName}</h3>
                        <p class="text-sm text-gray-600">Código de Rastreamento: <span class="font-mono">${id}</span></p>
                    </div>
                    <div class="relative space-y-8">
                `;

                dados.stages.forEach(etapa => {
                    const classeCorIcone = etapa.completed ? 'bg-natura-verde' : 'bg-gray-300';
                    const classeCorTexto = etapa.completed ? 'text-gray-800' : 'text-gray-500';
                    
                    htmlLinhaDoTempo += `
                        <div class="item-linha-tempo relative flex items-start ${classeCorTexto}">
                            <div class="absolute left-0 flex-shrink-0 flex items-center justify-center h-10 w-10 rounded-full ${classeCorIcone} text-white z-10">
                                <i data-lucide="${etapa.icon}" class="h-5 w-5"></i>
                            </div>
                            <div class="ml-16 pt-1">
                                <h4 class="font-semibold">${etapa.title}</h4>
                                <p class="text-sm">${etapa.status} - ${etapa.details}</p>
                                <time class="text-xs text-gray-400">${etapa.date}</time>
                            </div>
                        </div>
                    `;
                });
                
                htmlLinhaDoTempo += `</div>`;
                resultadoRastreamento.innerHTML = htmlLinhaDoTempo;
                lucide.createIcons();
            }

            // --- LÓGICA DE ESTOQUE E REQUISIÇÃO ---
            const formRequisicao = document.getElementById('formRequisicao');
            const selectProduto = document.getElementById('selectProduto');
            const inputQuantidade = document.getElementById('inputQuantidade');
            const feedbackRequisicao = document.getElementById('feedbackRequisicao');
            const valorPedidosAtivos = document.getElementById('valorPedidosAtivos');
            const valorNivelEstoque = document.getElementById('valorNivelEstoque');
            const listaPedidosRecentes = document.getElementById('listaPedidosRecentes');
            const listaAlertaEstoque = document.getElementById('listaAlertaEstoque');
            
            let pedidosRecentes = [];

            const nomesProdutos = Object.values(dadosFicticiosRastreamento).map(item => item.productName);
            const produtosUnicos = [...new Set(nomesProdutos)]; 
            
            // Inicializa os dados de estoque para todos os produtos
            let stockData = produtosUnicos.map(nome => {
                const hash = nome.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
                const maxStock = (hash % 4) * 50 + 250; 
                const stock = Math.floor((hash % 70 + 20) / 100 * maxStock);
                return { name: nome, stock: stock, maxStock: maxStock };
            });

            // Ajusta os dados para corresponder à exibição inicial
            const initialDisplayItems = {
                'Deo Parfum Essencial Oud': { stock: 48, maxStock: 320 },
                'Sabonete Líquido Ucuuba': { stock: 82, maxStock: 320 },
                'Perfume Kaiak Aventura': { stock: 110, maxStock: 320 },
                'Óleo Corporal Andiroba': { stock: 250, maxStock: 400 }
            };

            stockData = stockData.map(item => {
                return initialDisplayItems[item.name] ? { ...item, ...initialDisplayItems[item.name] } : item;
            });

            // Popula o dropdown de requisição
            produtosUnicos.forEach(nome => {
                const option = document.createElement('option');
                option.value = nome;
                option.textContent = nome;
                selectProduto.appendChild(option);
            });
            
            function renderizarAlertaEstoque() {
                if (!listaAlertaEstoque) return;

                const itensParaExibir = stockData
                    .filter(item => (item.stock / item.maxStock) < 0.85) // Itens abaixo de 85%
                    .sort((a, b) => a.stock - b.stock)
                    .slice(0, 4); 

                listaAlertaEstoque.innerHTML = ''; 

                if (itensParaExibir.length === 0) {
                    listaAlertaEstoque.innerHTML = '<p class="text-sm text-gray-500">Nenhum alerta de baixo estoque.</p>';
                    return;
                }

                itensParaExibir.forEach(item => {
                    const percentage = (item.stock / item.maxStock) * 100;
                    let barColorClass = 'bg-green-500';
                    if (percentage < 20) barColorClass = 'bg-red-500';
                    else if (percentage < 40) barColorClass = 'bg-yellow-500';

                    const itemHTML = `
                        <div class="flex items-center">
                            <div class="w-2/3">
                                <p class="text-sm font-medium">${item.name}</p>
                                <p class="text-xs text-gray-500">Restam: ${item.stock} un.</p>
                            </div>
                            <div class="w-1/3 bg-gray-200 rounded-full h-2.5">
                                <div class="${barColorClass} h-2.5 rounded-full" style="width: ${percentage.toFixed(2)}%"></div>
                            </div>
                        </div>
                    `;
                    listaAlertaEstoque.innerHTML += itemHTML;
                });
            }

            function atualizarNivelEstoqueGeral() {
                const totalStock = stockData.reduce((sum, item) => sum + item.stock, 0);
                const totalMaxStock = stockData.reduce((sum, item) => sum + item.maxStock, 0);
                const percentage = (totalStock / totalMaxStock) * 100;
                valorNivelEstoque.textContent = `${percentage.toFixed(1)}%`;
            }

            function gerarCodigoRastreamento() {
                let novoCodigo;
                do {
                    const randomNum = Math.floor(100 + Math.random() * 900);
                    novoCodigo = `NT2025BR${randomNum}`;
                } while (dadosFicticiosRastreamento[novoCodigo]);
                return novoCodigo;
            }

            function renderizarPedidosRecentes() {
                if (pedidosRecentes.length === 0) {
                    listaPedidosRecentes.innerHTML = `<p class="text-center text-gray-500 py-4">Nenhum pedido foi solicitado ainda.</p>`;
                    return;
                }

                let tabelaHTML = `
                    <table class="w-full text-left">
                        <thead>
                            <tr class="border-b">
                                <th class="p-2 font-semibold">Produto</th>
                                <th class="p-2 font-semibold">Código de Rastreamento</th>
                                <th class="p-2 font-semibold text-center">Quantidade</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                [...pedidosRecentes].reverse().forEach(pedido => {
                    tabelaHTML += `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="p-2">${pedido.nome}</td>
                            <td class="p-2 font-mono">${pedido.codigo}</td>
                            <td class="p-2 text-center">${pedido.quantidade}</td>
                        </tr>
                    `;
                });

                tabelaHTML += `
                        </tbody>
                    </table>
                `;
                listaPedidosRecentes.innerHTML = tabelaHTML;
            }
            
            formRequisicao.addEventListener('submit', (evento) => {
                evento.preventDefault();

                const produtoSelecionado = selectProduto.value;
                const quantidade = inputQuantidade.value;

                if (!quantidade || quantidade <= 0) {
                    feedbackRequisicao.innerHTML = `<span class="text-red-600">Por favor, insira uma quantidade válida.</span>`;
                    setTimeout(() => { feedbackRequisicao.innerHTML = ''; }, 4000);
                    return;
                }
                
                // Atualiza o estoque
                const produtoNoEstoque = stockData.find(p => p.name === produtoSelecionado);
                if (produtoNoEstoque) {
                    produtoNoEstoque.stock += parseInt(quantidade);
                    renderizarAlertaEstoque();
                    atualizarNivelEstoqueGeral();
                }

                const novoCodigo = gerarCodigoRastreamento();
                dadosFicticiosRastreamento[novoCodigo] = {
                    productName: produtoSelecionado,
                    stages: [
                        { icon: 'leaf', title: 'Coleta da Matéria-Prima', status: 'Concluído', details: 'Requisição recebida pelo fornecedor.', date: new Date().toLocaleDateString('pt-BR'), completed: true },
                        { icon: 'flask-conical', title: 'Processamento e Produção', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'warehouse', title: 'Chegada ao Centro de Distribuição', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'truck', title: 'Transporte para Consultora', status: 'Pendente', details: '', date: '', completed: false },
                        { icon: 'package-check', title: 'Entregue ao Cliente Final', status: 'Pendente', details: '', date: '', completed: false }
                    ]
                };

                pedidosRecentes.push({ nome: produtoSelecionado, codigo: novoCodigo, quantidade: quantidade });
                renderizarPedidosRecentes();

                feedbackRequisicao.innerHTML = `<span class="text-green-600 flex items-center justify-center"><i data-lucide="check-circle" class="h-5 w-5 mr-2"></i>Pedido solicitado! Rastreie com: <strong class="font-mono ml-2 p-1 bg-gray-200 rounded">${novoCodigo}</strong></span>`;
                lucide.createIcons();
                
                let totalPedidos = parseInt(valorPedidosAtivos.textContent.replace(/\./g, ''), 10);
                valorPedidosAtivos.textContent = (totalPedidos + 1).toLocaleString('pt-BR');
                
                formRequisicao.reset();

                setTimeout(() => { feedbackRequisicao.innerHTML = ''; }, 8000);
            });

            // Chamadas iniciais para renderizar o estado
            renderizarAlertaEstoque();
            atualizarNivelEstoqueGeral();
        });
    </script>
</body>
</html>
